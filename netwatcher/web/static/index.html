<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panopticon Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.10.0/dist/umd/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-http-backend@2.5.0/i18nextHttpBackend.min.js"></script>
</head>
<body>
    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay hidden">
        <div class="login-box">
            <img src="/img/panopticon.png" alt="Panopticon" class="login-logo" />
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username" data-i18n="login.username">Username</label>
                    <input type="text" id="login-username" class="input-search" autocomplete="username" style="width:100%" />
                </div>
                <div class="form-group">
                    <label for="login-password" data-i18n="login.password">Password</label>
                    <input type="password" id="login-password" class="input-search" autocomplete="current-password" style="width:100%" />
                </div>
                <div id="login-error" class="login-error"></div>
                <button type="submit" class="btn btn-accent" style="width:100%;margin-top:4px" data-i18n="login.button">Login</button>
            </form>
        </div>
    </div>

    <header>
        <div class="header-left">
            <span id="connection-status" class="status-dot disconnected" data-i18n="header.status.disconnected" title="WebSocket disconnected"></span>
            <h1>Panopticon</h1>
        </div>
        <div class="header-right">
            <select id="lang-selector" class="input-search" style="font-size:12px;padding:4px 8px;margin-right:8px;background:var(--bg-card);border-color:var(--border-color)">
                <option value="ko">ðŸ‡°ðŸ‡· í•œêµ­ì–´</option>
                <option value="en">ðŸ‡ºðŸ‡¸ English</option>
            </select>
            <button id="btn-logout" class="btn" style="display:none;font-size:12px;padding:5px 12px" data-i18n="header.logout">Logout</button>
            <span id="clock"></span>
        </div>
    </header>

    <main>
        <!-- Stats Cards -->
        <section class="stats-grid">
            <div class="stat-card critical">
                <div class="stat-icon">&#9888;</div>
                <div class="stat-value" id="stat-critical">0</div>
                <div class="stat-label" data-i18n="stats.critical">Critical</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon">&#9651;</div>
                <div class="stat-value" id="stat-warning">0</div>
                <div class="stat-label" data-i18n="stats.warning">Warning</div>
            </div>
            <div class="stat-card info">
                <div class="stat-icon">&#9432;</div>
                <div class="stat-value" id="stat-info">0</div>
                <div class="stat-label" data-i18n="stats.info">Info</div>
            </div>
            <div class="stat-card neutral">
                <div class="stat-icon">&#9654;</div>
                <div class="stat-value" id="stat-packets">0</div>
                <div class="stat-label" data-i18n="stats.total_packets">Total Packets</div>
            </div>
            <div class="stat-card neutral">
                <div class="stat-icon">&#9632;</div>
                <div class="stat-value" id="stat-devices">0</div>
                <div class="stat-label" data-i18n="stats.devices">Devices</div>
            </div>
            <div class="stat-card risk" id="stat-highrisk-card">
                <div class="stat-icon">&#9760;</div>
                <div class="stat-value" id="stat-highrisk">0</div>
                <div class="stat-label" data-i18n="stats.high_risk">High Risk</div>
            </div>
            <div class="stat-card visibility-card" id="stat-visibility-card" data-i18n="stats.visibility_hint" title="SPAN í¬íŠ¸ êµ¬ì„± ì‹œ ë‹¤ìˆ˜ í˜¸ìŠ¤íŠ¸ íŠ¸ëž˜í”½ì´ ê°€ì‹œí™”ë©ë‹ˆë‹¤">
                <div class="stat-icon">&#9673;</div>
                <div class="stat-value" id="stat-visibility">-</div>
                <div class="stat-label" data-i18n="stats.hosts_visible">Hosts Visible</div>
            </div>
        </section>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="events" data-i18n="tabs.events">Events</button>
            <button class="tab" data-tab="traffic" data-i18n="tabs.traffic">Traffic</button>
            <button class="tab" data-tab="devices" data-i18n="tabs.devices">Devices</button>
            <button class="tab" data-tab="blocklist" data-i18n="tabs.blocklist">Blocklist</button>
            <button class="tab" data-tab="whitelist" data-i18n="tabs.whitelist">Whitelist</button>
            <button class="tab" data-tab="engines" data-i18n="tabs.engines">Engines</button>
            <button class="tab" data-tab="ai-analyzer" id="tab-btn-ai-analyzer" style="display:none" data-i18n="tabs.ai_analyzer">AI Analyzer</button>
        </nav>

        <!-- Events Tab -->
        <section id="tab-events" class="tab-content active">
            <div class="toolbar">
                <select id="filter-severity">
                    <option value="" data-i18n="toolbar.all_severities">All Severities</option>
                    <option value="CRITICAL" data-i18n="stats.critical">Critical</option>
                    <option value="WARNING" data-i18n="stats.warning">Warning</option>
                    <option value="INFO" data-i18n="stats.info">Info</option>
                </select>
                <select id="filter-engine">
                    <option value="" data-i18n="toolbar.all_engines">All Engines</option>
                </select>
                <input type="text" id="filter-search" class="input-search" data-i18n="toolbar.search_placeholder" placeholder="Search events..." />
                <input type="date" id="filter-since" class="input-date" title="Since" />
                <input type="date" id="filter-until" class="input-date" title="Until" />
                <select id="filter-pagesize">
                    <option value="50">50 / page</option>
                    <option value="100" selected>100 / page</option>
                    <option value="200">200 / page</option>
                </select>
                <button id="btn-refresh" class="btn" data-i18n="toolbar.refresh">Refresh</button>
                <button id="btn-export-csv" class="btn btn-export" data-i18n="toolbar.export_csv">Export CSV</button>
                <button id="btn-export-json" class="btn btn-export" data-i18n="toolbar.export_json">Export JSON</button>
            </div>
            <div class="table-wrapper">
                <table id="events-table">
                    <thead>
                        <tr>
                            <th data-i18n="table.time">Time</th>
                            <th data-i18n="table.severity">Severity</th>
                            <th data-i18n="table.engine">Engine</th>
                            <th data-i18n="table.title">Title</th>
                            <th data-i18n="table.source">Source</th>
                            <th data-i18n="table.destination">Destination</th>
                            <th data-i18n="table.actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="events-body"></tbody>
                </table>
            </div>
            <div class="pagination" id="events-pagination"></div>
        </section>

        <!-- Traffic Tab -->
        <section id="tab-traffic" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Traffic Timeline (packets/min)</h3>
                    <canvas id="chart-traffic"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Protocol Distribution</h3>
                    <canvas id="chart-protocols"></canvas>
                </div>
            </div>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Alerts by Severity (24h)</h3>
                    <canvas id="chart-severity"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Alerts by Engine (24h)</h3>
                    <canvas id="chart-engines"></canvas>
                </div>
            </div>
        </section>

        <!-- Devices Tab -->
        <section id="tab-devices" class="tab-content">
            <div id="inv-summary" class="inv-summary"></div>
            <div class="toolbar">
                <select id="devices-filter-type">
                    <option value="">All Types</option>
                    <option value="pc">PC</option>
                    <option value="mobile">Mobile</option>
                    <option value="printer">Printer</option>
                    <option value="router">Router</option>
                    <option value="nas">NAS</option>
                    <option value="server">Server</option>
                    <option value="iot">IoT</option>
                    <option value="unknown">Unknown</option>
                </select>
                <select id="devices-filter-known">
                    <option value="">All Devices</option>
                    <option value="known">Registered</option>
                    <option value="unregistered">Unregistered</option>
                </select>
                <input type="text" id="devices-search" class="input-search" placeholder="Search devices..." />
                <button id="btn-register-device" class="btn btn-accent">Register Device</button>
            </div>
            <div class="table-wrapper">
                <table id="devices-table">
                    <thead>
                        <tr>
                            <th>Risk</th>
                            <th>Type</th>
                            <th>Nickname</th>
                            <th>MAC Address</th>
                            <th>Vendor</th>
                            <th>IP Address</th>
                            <th>Hostname</th>
                            <th>OS</th>
                            <th>First Seen</th>
                            <th>Last Seen</th>
                            <th>Packets</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="devices-body"></tbody>
                </table>
            </div>
            <div class="pagination" id="devices-pagination"></div>
        </section>

        <!-- Blocklist Tab -->
        <section id="tab-blocklist" class="tab-content">
            <div class="toolbar">
                <select id="bl-filter-type">
                    <option value="">All Types</option>
                    <option value="ip">IP</option>
                    <option value="domain">Domain</option>
                </select>
                <select id="bl-filter-source">
                    <option value="">All Sources</option>
                    <option value="custom">Custom</option>
                    <option value="feed">Feed</option>
                </select>
                <input type="text" id="bl-search" class="input-search" placeholder="Search blocklist..." />
                <button id="btn-add-blocklist" class="btn btn-accent">Add Entry</button>
            </div>
            <div id="bl-stats" class="bl-stats"></div>
            <div class="table-wrapper">
                <table id="blocklist-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Source</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="blocklist-body"></tbody>
                </table>
            </div>
            <div class="pagination" id="blocklist-pagination"></div>
        </section>

        <!-- Whitelist Tab -->
        <section id="tab-whitelist" class="tab-content">
            <div class="toolbar">
                <select id="wl-filter-type">
                    <option value="">All Types</option>
                    <option value="ip">IP</option>
                    <option value="mac">MAC</option>
                    <option value="domain">Domain</option>
                    <option value="ip_range">IP Range</option>
                </select>
                <input type="text" id="wl-search" class="input-search" placeholder="Search whitelist..." />
                <button id="btn-add-whitelist" class="btn btn-accent">Add Entry</button>
            </div>
            <div class="table-wrapper">
                <table id="whitelist-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="whitelist-body"></tbody>
                </table>
            </div>
        </section>

        <!-- Engines Tab -->
        <section id="tab-engines" class="tab-content">
            <div class="engines-layout">
                <div class="engines-list" id="engines-list"></div>
                <div class="engine-detail" id="engine-detail">
                    <div class="engine-detail-empty">Select an engine to configure</div>
                </div>
            </div>
        </section>

        <!-- AI Analyzer Tab -->
        <section id="tab-ai-analyzer" class="tab-content">
            <div id="ai-analyzer-status-bar" class="toolbar" style="align-items:center;gap:16px;flex-wrap:wrap;">
                <span>Provider: <strong id="ai-provider">â€”</strong></span>
                <span>Interval: <strong id="ai-interval">â€”</strong> min</span>
                <span>Lookback: <strong id="ai-lookback">â€”</strong> min</span>
                <span>FP Threshold: <strong id="ai-fp-threshold">â€”</strong></span>
            </div>
            <div class="toolbar" style="margin-top:8px">
                <select id="ai-filter-verdict">
                    <option value="">All Verdicts</option>
                    <option value="CONFIRMED_THREAT">Confirmed Threat</option>
                    <option value="FALSE_POSITIVE">False Positive</option>
                    <option value="UNCERTAIN">Uncertain</option>
                    <option value="adjustment">Adjustment</option>
                </select>
                <select id="ai-filter-pagesize">
                    <option value="50" selected>50 / page</option>
                    <option value="100">100 / page</option>
                </select>
                <button id="btn-ai-refresh" class="btn">Refresh</button>
            </div>
            <div class="table-wrapper">
                <table id="ai-logs-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Verdict</th>
                            <th>Engine</th>
                            <th>Reason</th>
                            <th>Adjustments</th>
                            <th>Provider</th>
                        </tr>
                    </thead>
                    <tbody id="ai-logs-body"></tbody>
                </table>
            </div>
            <div class="pagination" id="ai-logs-pagination"></div>
        </section>
    </main>

    <!-- Event Detail Modal -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">Event Detail</h2>
                <button class="modal-close" id="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <!-- Device Detail Modal -->
    <div id="device-modal-overlay" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 id="device-modal-title">Device Detail</h2>
                <button class="modal-close" id="device-modal-close-btn">&times;</button>
            </div>
            <div class="modal-body" id="device-modal-body"></div>
        </div>
    </div>

    <!-- Register/Edit Device Modal -->
    <div id="device-form-overlay" class="modal-overlay hidden">
        <div class="modal" style="max-width:500px">
            <div class="modal-header">
                <h2 id="device-form-title">Register Device</h2>
                <button class="modal-close" id="device-form-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="device-form">
                    <input type="hidden" id="df-mode" value="register" />
                    <div class="form-group">
                        <label for="df-mac">MAC Address</label>
                        <input type="text" id="df-mac" class="input-search" placeholder="aa:bb:cc:dd:ee:ff" style="width:100%" />
                    </div>
                    <div class="form-group">
                        <label for="df-nickname">Nickname *</label>
                        <input type="text" id="df-nickname" class="input-search" placeholder="e.g. Office Printer" style="width:100%" />
                    </div>
                    <div class="form-group">
                        <label for="df-ip">IP Address</label>
                        <input type="text" id="df-ip" class="input-search" placeholder="192.168.1.100" style="width:100%" />
                    </div>
                    <div class="form-group">
                        <label for="df-hostname">Hostname</label>
                        <input type="text" id="df-hostname" class="input-search" placeholder="printer.local" style="width:100%" />
                    </div>
                    <div class="form-group">
                        <label for="df-os">OS Hint</label>
                        <input type="text" id="df-os" class="input-search" placeholder="Linux" style="width:100%" />
                    </div>
                    <div class="form-group">
                        <label for="df-notes">Notes</label>
                        <textarea id="df-notes" class="input-search" rows="3" placeholder="Additional notes..." style="width:100%"></textarea>
                    </div>
                    <div id="df-error" style="color:var(--critical);font-size:13px;margin-bottom:8px;display:none"></div>
                    <div class="form-actions">
                        <button type="button" class="btn" id="device-form-cancel-btn">Cancel</button>
                        <button type="submit" class="btn btn-accent">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Blocklist Entry Modal -->
    <div id="blocklist-form-overlay" class="modal-overlay hidden">
        <div class="modal" style="max-width:500px">
            <div class="modal-header">
                <h2>Add Blocklist Entry</h2>
                <button class="modal-close" id="blocklist-form-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="blocklist-form">
                    <div class="form-group">
                        <label for="bf-type">Type</label>
                        <select id="bf-type" style="width:100%">
                            <option value="ip">IP Address</option>
                            <option value="domain">Domain</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bf-value">Value</label>
                        <input type="text" id="bf-value" class="input-search" placeholder="e.g. 10.0.0.1 or evil.com" style="width:100%" />
                    </div>
                    <div class="form-group">
                        <label for="bf-notes">Notes</label>
                        <textarea id="bf-notes" class="input-search" rows="2" placeholder="Reason for blocking..." style="width:100%"></textarea>
                    </div>
                    <div id="bf-error" style="color:var(--critical);font-size:13px;margin-bottom:8px;display:none"></div>
                    <div class="form-actions">
                        <button type="button" class="btn" id="blocklist-form-cancel-btn">Cancel</button>
                        <button type="submit" class="btn btn-accent">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Whitelist Entry Modal -->
    <div id="whitelist-form-overlay" class="modal-overlay hidden">
        <div class="modal" style="max-width:500px">
            <div class="modal-header">
                <h2>Add Whitelist Entry</h2>
                <button class="modal-close" id="whitelist-form-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="whitelist-form">
                    <div class="form-group">
                        <label for="wf-type">Type</label>
                        <select id="wf-type" style="width:100%">
                            <option value="ip">IP Address</option>
                            <option value="mac">MAC Address</option>
                            <option value="domain">Domain</option>
                            <option value="ip_range">IP Range (CIDR)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="wf-value">Value</label>
                        <input type="text" id="wf-value" class="input-search" placeholder="e.g. 192.168.0.1 or trusted.com" style="width:100%" />
                    </div>
                    <div id="wf-error" style="color:var(--critical);font-size:13px;margin-bottom:8px;display:none"></div>
                    <div class="form-actions">
                        <button type="button" class="btn" id="whitelist-form-cancel-btn">Cancel</button>
                        <button type="submit" class="btn btn-accent">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>
    <script type="module" src="/js/app.js"></script>
</body>
</html>
